<div class="particles" id="particles-js"></div>
<nav class="top-nav">
  <div class="logo">RealWorld XP</div>
  <button class="dashboard-btn" title="‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ Dashboard" (click)="goToDashboard()">üè†</button>
</nav>

<main class="main-content">
  @if (currentStep === 'loading') {
  <div class="loading-spinner"></div>
  } @if (currentStep === 'start' && activity) {
  <div class="activity-card">
    <div class="activity-header">
      <h1 class="activity-title">{{ activity.name }}</h1>
      <div class="tags-row">
        <span class="tag">Indoor</span>
        <span class="tag">{{ activity.base_time }} mins</span>
      </div>
    </div>
    <div class="illustration-area">
      <div class="activity-illustration">{{ activityIcon }}</div>
    </div>
    <p class="description">{{ activity.description }}</p>
    <button class="btn-start" (click)="startActivity()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
  </div>
  } @if (currentStep === 'timer' && activity) {
  <div class="activity-card">
    <div class="activity-header">
      <h2 class="activity-title" style="font-size: 28px">{{ activity.name }}</h2>
    </div>
    <div class="timer-section">
      <div class="timer-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
      <div class="timer-display" [class.paused]="isPaused">{{ formattedTime }}</div>
    </div>
    <div class="controls-row">
      <button class="btn-pause" (click)="togglePause()">
        {{ isPaused ? '‚ñ∂ ‡∏ó‡∏≥‡∏ï‡πà‡∏≠' : '‚è∏ ‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß' }}
      </button>
      <button class="btn-cancel" (click)="showCancelModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
    </div>
  </div>
  } @if (currentStep === 'complete' && user && activity) {
  <div class="success-card">
    <div class="confetti" id="confetti-js"></div>
    <div class="success-icon">
      <div class="success-circle"><div class="checkmark">‚úì</div></div>
    </div>
    <div class="success-header"><h1>‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</h1></div>
    <div class="reward-card">
      <div class="reward-content">
        <div class="reward-item">
          <div class="xp-value">+{{ activity.base_xp }} XP üéâ</div>
          <div class="reward-label">‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå</div>
        </div>
        @if (user.is_success) {
        <div class="reward-item">
          <div class="streak-value">üî• {{ user.day_streak }}</div>
          <div class="reward-label">‡∏ß‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô</div>
        </div>
        }
      </div>
      <div class="xp-progress">
        <div class="xp-progress-label">
          <span>Level {{ user.level }}</span>
          <span>{{ user.current_xp }} / {{ user.xp_for_next_level }} XP</span>
        </div>
        <div class="xp-progress-bar">
          <div class="xp-progress-fill" [style.width.%]="xpProgressPercentage"></div>
        </div>
      </div>
    </div>
    <div class="action-buttons">
      <button class="btn-secondary" (click)="goToDashboard()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ Dashboard</button>
    </div>
  </div>
  }
</main>

@if (isModalVisible) {
<div class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2 class="modal-header">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</h2>
    <p class="modal-subtext">
      ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ? ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
    </p>
    <div class="modal-buttons">
      <button class="btn-keep-going" (click)="closeModal()">‡∏ó‡∏≥‡∏ï‡πà‡∏≠</button>
      <button class="btn-confirm-cancel" (click)="confirmCancel()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
  </div>
</div>
}
